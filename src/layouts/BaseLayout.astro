---
import '../styles/global.css';

export interface Props {
	title?: string;
	description?: string;
	lang?: string;
}

const { 
	title = "KI-Strategien für Schweizer KMU | Falx", 
	description = "Sparen Sie 31 Stunden Administration pro Monat mit massgeschneiderten KI-Lösungen für Schweizer KMU. DSG-konform. Erste Lösung in 14 Tagen. Kostenlose Beratung.",
	lang = "de"
} = Astro.props;
---

<html lang={lang}>
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<meta name="generator" content={Astro.generator} />
		<meta name="description" content={description} />
		<title>{title}</title>
	</head>
	<body>
		<slot />
		<script>
			// Ensure page always starts at top on load/refresh
			if ('scrollRestoration' in history) {
				history.scrollRestoration = 'manual';
			}
			window.addEventListener('beforeunload', () => {
				window.scrollTo(0, 0);
			});
			window.addEventListener('load', () => {
				window.scrollTo(0, 0);
			});

			// Automatic language detection based on browser language
			// Only runs once per session, non-intrusive
			function detectAndRedirectLanguage() {
				// Skip if already on a language-specific page or detection already done
				if (window.location.pathname.match(/^\/[a-z]{2}\//) || sessionStorage.getItem('langDetected')) {
					return;
				}

				// Mark detection as completed for this session
				sessionStorage.setItem('langDetected', 'true');

				// Get browser language
				const browserLang = navigator.language || navigator.userLanguage;
				if (!browserLang) return;

				// Check for German variants (de, de-DE, de-CH, de-AT)
				const isGermanVariant = /^de(-[A-Z]{2})?$/i.test(browserLang);

				// If not German variant, redirect to English
				if (!isGermanVariant) {
					const currentPath = window.location.pathname;
					const englishPath = currentPath === '/' ? '/en' : `/en${currentPath}`;
					window.location.href = englishPath;
				}
			}

			// Run detection when DOM is loaded
			if (document.readyState === 'loading') {
				document.addEventListener('DOMContentLoaded', detectAndRedirectLanguage);
			} else {
				detectAndRedirectLanguage();
			}
		</script>
	</body>
</html>