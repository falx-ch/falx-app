---
// Multi-language legal page
// German uses /legal (no prefix)
// Other languages use this file with [lang] parameter

// Import utilities
import { loadTranslations, getLanguageFromPath, type SupportedLanguage } from '@/lib/i18n';

// Get language from URL parameter
export async function getStaticPaths() {
  return [
    { params: { lang: 'en' } }
    // { params: { lang: 'fr' } }, // Ready for future
    // { params: { lang: 'it' } }, // Ready for future
  ];
}

const { lang } = Astro.params as { lang: SupportedLanguage };

// Load translations for this language
const translations = await loadTranslations(lang);

// Set up meta data
const meta = {
  title: translations.legal.meta.title,
  description: translations.legal.meta.description,
  lang: lang
};

// Import layout and components
import BaseLayout from '../../layouts/BaseLayout.astro';
import Header from '../../components/header.tsx';
import SimpleFooter from '../../components/simple-footer.tsx';
---

<BaseLayout title={meta.title} description={meta.description} lang={meta.lang}>
  <!-- SVG Filters for header animations -->
  <svg style="position: absolute; width: 0; height: 0; pointer-events: none;">
    <defs>
      <filter id="gooey-filter" x="-50%" y="-50%" width="200%" height="200%">
        <feGaussianBlur in="SourceGraphic" stdDeviation="4" result="blur" />
        <feColorMatrix
          in="blur"
          mode="matrix"
          values="1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 19 -9"
          result="goo"
        />
        <feComposite in="SourceGraphic" in2="goo" operator="atop" />
      </filter>
    </defs>
  </svg>

  <!-- Use exact same header as main site -->
  <div class="bg-slate-900">
    <Header client:load />
  </div>
  
  <!-- Legal Content -->
  <main class="min-h-screen bg-slate-50 text-slate-900 py-16 lg:py-24">
    <div class="max-w-4xl mx-auto px-6 lg:px-8">
      
      <!-- Page Header -->
      <header class="text-center mb-16">
        <h1 class="text-4xl lg:text-5xl font-light mb-4 tracking-tight leading-tight text-slate-900">
          {translations.legal.page_header.title}
        </h1>
        <p class="text-slate-600 text-lg">
          {translations.legal.page_header.subtitle}
        </p>
        
        <!-- Quick Navigation -->
        <nav class="mt-8 flex justify-center gap-6">
          <a href="#impressum" class="text-red-600 hover:text-red-700 font-medium transition-colors duration-200">
            {translations.legal.navigation.impressum}
          </a>
          <a href="#datenschutz" class="text-red-600 hover:text-red-700 font-medium transition-colors duration-200">
            {translations.legal.navigation.datenschutz}
          </a>
        </nav>
      </header>

      <!-- Impressum Section -->
      <section id="impressum" class="mb-16 scroll-mt-24">
        <div class="bg-white rounded-2xl p-8 lg:p-12 shadow-sm border border-slate-200">
          <h2 class="text-3xl font-light mb-8 text-slate-900 border-b border-slate-200 pb-4">
            {translations.legal.impressum.title}
          </h2>
          
          <div class="prose prose-lg prose-slate max-w-none">
            <div class="space-y-6 text-slate-700">
              <p class="font-medium text-lg">{translations.legal.impressum.legal_basis}</p>
              
              <div>
                <p><strong>{translations.legal.impressum.company_info.name}</strong><br />
                <Fragment set:html={translations.legal.impressum.company_info.address} /></p>
              </div>

              <div>
                <p><strong>{translations.legal.impressum.contact.label}</strong><br />
                E-Mail: <span id="email-address" class="text-red-600">
                  <noscript>{translations.legal.impressum.contact.email_placeholder}</noscript>
                </span></p>
              </div>

              <div>
                <p><strong>{translations.legal.impressum.representative.label}</strong><br />
                {translations.legal.impressum.representative.name}</p>
              </div>

              <div>
                <p><strong>{translations.legal.impressum.registration.label}</strong><br />
                {translations.legal.impressum.registration.company_name}<br />
                {translations.legal.impressum.registration.uid}</p>
              </div>

              <div>
                <p><strong>{translations.legal.impressum.disclaimer.label}</strong><br />
                {translations.legal.impressum.disclaimer.text}</p>
              </div>

              <div>
                <p><strong>{translations.legal.impressum.links_disclaimer.label}</strong><br />
                {translations.legal.impressum.links_disclaimer.text}</p>
              </div>
            </div>

            <script>
              // Email obfuscation protection
              document.addEventListener('DOMContentLoaded', function() {
                const emailElement = document.getElementById('email-address');
                if (emailElement) {
                  // Encoded email: legal@falx.ch
                  const user = 'legal';
                  const domain = 'falx.ch';
                  const email = user + '@' + domain;
                  
                  emailElement.innerHTML = '<a href="mailto:' + email + '" class="text-red-600 hover:text-red-700 transition-colors">' + email + '</a>';
                }
              });
            </script>
          </div>
        </div>
      </section>

      <!-- Datenschutz Section -->
      <section id="datenschutz" class="mb-16 scroll-mt-24">
        <div class="bg-white rounded-2xl p-8 lg:p-12 shadow-sm border border-slate-200">
          <h2 class="text-3xl font-light mb-8 text-slate-900 border-b border-slate-200 pb-4">
            {translations.legal.datenschutz.title}
          </h2>
          
          <div class="prose prose-lg prose-slate max-w-none">
            <div class="space-y-6 text-slate-700">
              <p class="font-medium text-lg">{translations.legal.datenschutz.subtitle}</p>
              <p class="text-sm text-slate-600 italic">{translations.legal.datenschutz.version}</p>
              
              <p>{translations.legal.datenschutz.intro}</p>

              <div>
                <h3 class="text-xl font-semibold text-slate-900 mb-3">{translations.legal.datenschutz.sections.responsible_entity.title}</h3>
                <p>{translations.legal.datenschutz.sections.responsible_entity.text}</p>
                <p class="mt-3">
                  <strong><Fragment set:html={translations.legal.datenschutz.sections.responsible_entity.company_details} /></strong>
                </p>
                <p class="mt-3" set:html={translations.legal.datenschutz.sections.responsible_entity.contact_info}>
                </p>
              </div>

              <div>
                <h3 class="text-xl font-semibold text-slate-900 mb-3">{translations.legal.datenschutz.sections.server_logs.title}</h3>
                <p>{translations.legal.datenschutz.sections.server_logs.hosting_info}</p>
                <p class="mt-3">{translations.legal.datenschutz.sections.server_logs.data_collection}</p>
                <ul class="mt-3 list-disc list-inside space-y-1">
                  {translations.legal.datenschutz.sections.server_logs.data_types.map((item: string) => (
                    <li>{item}</li>
                  ))}
                </ul>
                <p class="mt-3">{translations.legal.datenschutz.sections.server_logs.purpose}</p>
              </div>

              <div>
                <h3 class="text-xl font-semibold text-slate-900 mb-3">{translations.legal.datenschutz.sections.email_service.title}</h3>
                <p>{translations.legal.datenschutz.sections.email_service.description}</p>
                {translations.legal.datenschutz.sections.email_service.subsections && (
                  <div class="mt-4 space-y-4">
                    {Object.values(translations.legal.datenschutz.sections.email_service.subsections).map((subsection: any) => (
                      <div class="pl-4 border-l-2 border-slate-200">
                        <h4 class="font-semibold text-slate-800 mb-2">{subsection.title}</h4>
                        <p class="text-slate-700" set:html={subsection.description}></p>
                      </div>
                    ))}
                  </div>
                )}
              </div>

              <div>
                <h3 class="text-xl font-semibold text-slate-900 mb-3">{translations.legal.datenschutz.sections.booking_communication.title}</h3>
                {translations.legal.datenschutz.sections.booking_communication.subsections && (
                  <div class="space-y-4">
                    {Object.values(translations.legal.datenschutz.sections.booking_communication.subsections).map((subsection: any) => (
                      <div class="pl-4 border-l-2 border-slate-200">
                        <h4 class="font-semibold text-slate-800 mb-2">{subsection.title}</h4>
                        <p class="text-slate-700" set:html={subsection.description}></p>
                      </div>
                    ))}
                  </div>
                )}
              </div>

              <div>
                <h3 class="text-xl font-semibold text-slate-900 mb-3">{translations.legal.datenschutz.sections.ai_services.title}</h3>
                <p>{translations.legal.datenschutz.sections.ai_services.description}</p>
                {translations.legal.datenschutz.sections.ai_services.subsections && (
                  <div class="mt-4 space-y-4">
                    {Object.values(translations.legal.datenschutz.sections.ai_services.subsections).map((subsection: any) => (
                      <div class="pl-4 border-l-2 border-slate-200">
                        <h4 class="font-semibold text-slate-800 mb-2">{subsection.title}</h4>
                        <p class="text-slate-700" set:html={subsection.description}></p>
                      </div>
                    ))}
                  </div>
                )}
              </div>

              <div>
                <h3 class="text-xl font-semibold text-slate-900 mb-3">{translations.legal.datenschutz.sections.voice_services.title}</h3>
                {translations.legal.datenschutz.sections.voice_services.subsections && (
                  <div class="space-y-4">
                    {Object.values(translations.legal.datenschutz.sections.voice_services.subsections).map((subsection: any) => (
                      <div class="pl-4 border-l-2 border-slate-200">
                        <h4 class="font-semibold text-slate-800 mb-2">{subsection.title}</h4>
                        <p class="text-slate-700" set:html={subsection.description}></p>
                      </div>
                    ))}
                  </div>
                )}
              </div>

              <div>
                <h3 class="text-xl font-semibold text-slate-900 mb-3">{translations.legal.datenschutz.sections.automation_services.title}</h3>
                {translations.legal.datenschutz.sections.automation_services.subsections && (
                  <div class="space-y-4">
                    {Object.values(translations.legal.datenschutz.sections.automation_services.subsections).map((subsection: any) => (
                      <div class="pl-4 border-l-2 border-slate-200">
                        <h4 class="font-semibold text-slate-800 mb-2">{subsection.title}</h4>
                        <p class="text-slate-700" set:html={subsection.description}></p>
                      </div>
                    ))}
                  </div>
                )}
              </div>

              <div>
                <h3 class="text-xl font-semibold text-slate-900 mb-3">{translations.legal.datenschutz.sections.crm_forms.title}</h3>
                {translations.legal.datenschutz.sections.crm_forms.subsections && (
                  <div class="space-y-4">
                    {Object.values(translations.legal.datenschutz.sections.crm_forms.subsections).map((subsection: any) => (
                      <div class="pl-4 border-l-2 border-slate-200">
                        <h4 class="font-semibold text-slate-800 mb-2">{subsection.title}</h4>
                        <p class="text-slate-700" set:html={subsection.description}></p>
                      </div>
                    ))}
                  </div>
                )}
              </div>

              <div>
                <h3 class="text-xl font-semibold text-slate-900 mb-3">{translations.legal.datenschutz.sections.analytics.title}</h3>
                <p>{translations.legal.datenschutz.sections.analytics.description}</p>
              </div>

              <div>
                <h3 class="text-xl font-semibold text-slate-900 mb-3">{translations.legal.datenschutz.sections.data_security.title}</h3>
                <p>{translations.legal.datenschutz.sections.data_security.description}</p>
              </div>

              <div>
                <h3 class="text-xl font-semibold text-slate-900 mb-3">{translations.legal.datenschutz.sections.data_retention.title}</h3>
                <p>{translations.legal.datenschutz.sections.data_retention.description}</p>
              </div>

              <div>
                <h3 class="text-xl font-semibold text-slate-900 mb-3">{translations.legal.datenschutz.sections.user_rights.title}</h3>
                <p>{translations.legal.datenschutz.sections.user_rights.description}</p>
              </div>

              <div>
                <h3 class="text-xl font-semibold text-slate-900 mb-3">{translations.legal.datenschutz.sections.policy_changes.title}</h3>
                <p>{translations.legal.datenschutz.sections.policy_changes.description}</p>
              </div>
            </div>

            <script>
              // Email obfuscation for legal email in Datenschutz section
              document.addEventListener('DOMContentLoaded', function() {
                const legalEmailElement = document.getElementById('legal-email-address');
                if (legalEmailElement) {
                  // Encoded email: legal@falx.ch
                  const user = 'legal';
                  const domain = 'falx.ch';
                  const email = user + '@' + domain;
                  
                  legalEmailElement.innerHTML = '<a href="mailto:' + email + '" class="text-red-600 hover:text-red-700 transition-colors">' + email + '</a>';
                }
              });
            </script>
          </div>
        </div>
      </section>

      <!-- Back to Top -->
      <div class="text-center">
        <a href="#" class="inline-flex items-center gap-2 text-slate-600 hover:text-slate-900 transition-colors duration-200">
          <span>↑</span>
          <span>{translations.legal.back_to_top}</span>
        </a>
      </div>

    </div>
  </main>

  <SimpleFooter client:idle />

  <!-- Smooth scroll CSS -->
  <style>
    html {
      scroll-behavior: smooth;
    }
  </style>
</BaseLayout>

<!-- Make translations available to components -->
<script define:vars={{ translations, lang }}>
  // Make translations globally available for React components
  window.__TRANSLATIONS__ = translations;
  window.__CURRENT_LANG__ = lang;
</script>